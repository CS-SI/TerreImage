<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <title>Welcome to qgiseducation's documentation!</title>
  <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <link rel="stylesheet" href="styles.css">
</head>
<body>
<header>
<h1 class="title">Welcome to qgiseducation's documentation!</h1>
</header>
<p>Contents:</p>
<h1 id="indices-and-tables">Indices and tables</h1>
<ul>
<li>:ref:`genindex`</li>
<li>:ref:`modindex`</li>
<li>:ref:`search`</li>
</ul>
<h1 id="module-dockablemirrormap">Module DockableMirrorMap</h1>
<ul>
<li>3 modules</li>
<li>permet l'affichage multivue</li>
</ul>
<h2 id="dockablemirrormapplugin">dockableMirrorMapPlugin</h2>
<p>Ce module est le mondule principal qui initialise le plugin. Il contient :</p>
<ul>
<li>une liste des vues</li>
<li>les actions permettant la sauvegarde des vues lors de la sauvegarde du projet QGIS</li>
<li>les actions permettant de restaurer les vues lors de l'ouverture d'un projet QGIS</li>
<li>ajoute une vue en réponse au clic du bouton du plugin</li>
</ul>
<h2 id="dockablemirrormap">dockableMirrorMap</h2>
<p>Ce module gère un widget mirror dans QGIS. Ce module permet de :</p>
<ul>
<li>creer le widget MirrorMap qui va permettre l'affichage de l'image</li>
<li>donner un titre à la vue</li>
<li>positionner la vue dans l'interface de qgis</li>
</ul>
<p>L'attribut <code>title</code> a été ajouté pour permettre de mettre un nom personnalisé à la vue créée. il est utilisé dans <code>setNumber()</code>.</p>
<h2 id="mirrormap">mirrorMap</h2>
<p>Cette classe gère toute la vue.</p>
<ul>
<li>Pour chaque nouvelle vue, on y associe un nouveau QgsMapCanvas.</li>
<li>Le canvas est mis à blanc ( noir par défaut )</li>
<li>Les boutons &quot;add layer&quot;, &quot;remove layer&quot;, la checkbox de rendu, ainsi que l'option de mise à l'échelle sont ajoutés à la vue</li>
</ul>
<p>Par simplification seul le nom de la vue et le canvas ont été laissés de l'interface d'une vue.</p>
<h3 id="addlayer">addLayer</h3>
<blockquote>
<dl>
<dt>::</dt>
<dd><dl>
<dt>def addLayer(self, layerId=None):</dt>
<dd><p># dans la plupart des cas, le layerID est None if layerId == None: # on prend la layer current layer = self.iface.activeLayer() else: # sinon, on récupère la layer layerID layer = QgsMapLayerRegistry.instance().mapLayer( layerId )</p>
<dl>
<dt>if layer == None:</dt>
<dd><p>return</p>
</dd>
</dl>
<p>prevFlag = self.canvas.renderFlag() #stop rendering self.canvas.setRenderFlag( False )</p>
<p># add the layer to the map canvas layer set self.canvasLayers = [] # id to canvas layer dictionnary id2cl_dict = {} # for each layer for l in self.iface.legendInterface().layers(): # lid est l'id de la layer l lid = self._layerId(l) #si la layer a été chargée précédemment dans la vue if self.layerId2canvasLayer.has_key( lid ): # previously added cl = self.layerId2canvasLayer[ lid ] elif l == layer: # selected layer cl = QgsMapCanvasLayer( layer ) else: continue print type(cl) #qgis.gui.QgsMapCanvasLayer</p>
<blockquote>
<p># maj dictionnaire id/canvas layer id2cl_dict[ lid ] = cl #ajout de la canvas layer self.canvasLayers.append( cl )</p>
</blockquote>
<p>self.layerId2canvasLayer = id2cl_dict self.canvas.setLayerSet( self.canvasLayers )</p>
<p>self.refreshLayerButtons() self.onExtentsChanged() #remet le rendering comme avant l'opération self.canvas.setRenderFlag( prevFlag )</p>
</dd>
</dl>
</dd>
</dl>
</blockquote>
<h2 id="developpement">Developpement</h2>
<p>Le zoom lié n'a pas été mis en place parce que le signal extentChanged génère une boucle.</p>
<h1 id="développement-du-module-principal">Développement du module principal</h1>
<p>Le module principal est comme suit :</p>
<p>:<code>qgiseducation</code>: Fichier principal du plugin. Il initialise le widget et crée les menus.</p>
<p>:<code>qgiseducationwidget</code>: Ce fichier s'occupe de toute l'interface widget.</p>
<p>:<code>process_manager</code>: Ce fichier contient la classe qui va gérer le plugin. Cette classe contient la liste des process, la layer courante et le répertoire de travail.</p>
<dl>
<dt>:<code>terre_image_task</code>: Ce fichier contient les classes de traitement.</dt>
<dd><p>Il y a une classe mère de tache et deux classes filles, <code>processing</code> et <code>display</code>. La première lance les traitements d'image tels que le NDVI et le KMEANS, la seconde va afficher les bandes spectrales et d'autres informations.</p>
</dd>
</dl>
<h1 id="qgis-plugin-builder">QGIS Plugin Builder</h1>
<h1 id="concepts">Concepts</h1>
<p>Plugin Builder provides you a working template from which you can create your own plugin.</p>
<p>The steps to using Plugin Builder are fairly simple:</p>
<ol>
<li>Open the Plugin Builder from within QGIS</li>
<li>Fill out the required information</li>
<li>Click OK</li>
<li>Designate where to store your new plugin</li>
<li>Compile your resource and user interface files</li>
<li>Install the plugin</li>
<li>Test it</li>
</ol>
<h1 id="running-plugin-builder">Running Plugin Builder</h1>
<p>When you run Plugin Builder you will see a dialog with text fields on the right and descriptions on the left:</p>
<img src="images/pluginbuilder.png" alt="image">
<p>The descriptions give you a hint about what is required for each field. The following sections describe the required and optional parameters in greater detail.</p>
<h4 id="required-parameters">Required Parameters</h4>
<dl>
<dt>Class name</dt>
<dd><p>This is the name that will be used to create the Python class for your plugin. The name should be in CamelCase with no spaces. Plugin Builder will accept an all lower case class name but this should be avoided since it isn't in line with Python coding style. Examples of valid class names are:</p>
</dd>
</dl>
<ul>
<li>MyPlugin</li>
<li>PluginBuilder</li>
<li>ScriptRunner</li>
</ul>
<dl>
<dt>Plugin name</dt>
<dd><p>This is a title for your plugin and will be displayed in the QGIS plugin manager and the plugin installer. It will also be used as the menu name that appears in the QGIS Plugin menu. You can use the Class name, or make it more readable. Some examples:</p>
</dd>
</dl>
<ul>
<li>My Plugin</li>
<li>Plugin Builder</li>
<li>ScriptRunner</li>
</ul>
<dl>
<dt>Description</dt>
<dd><p>This is a one line description of the plugin's function and is displayed in both the Plugin Manager and Plugin Installer. Keep it short yet descriptive so the purpose of the plugin can be easily determined.</p>
</dd>
<dt>Version number</dt>
<dd><p>This is the version number of your plugin. Plugin Builder suggests 0.1, but you can start with any number. The Plugin Installer uses the version number to identify which plugins you have installed are upgradeable so it is important to increment it as you release new versions.</p>
</dd>
<dt>Minimum QGIS version</dt>
<dd><p>This is the minimum version of QGIS required for your plugin to work. If your plugin uses features only present in a newer version, be sure to set this field accordingly to prevent problems for those running older versions. Version 2.0 of Plugin Builder defaults this field to 2.0.</p>
</dd>
<dt>Text for the menu item</dt>
<dd><p>This is the text that will appear in the menu. In the example below, the plugin name is Frog Pond and the text for the menu item is displayed to the right of it:</p>
</dd>
</dl>
<img src="images/plugin_menu.png" alt="image">
<p>In general you shouldn't use the same text for the plugin name and the menu item; if you do your menu will look like this:</p>
<img src="images/redundant_menu.png" alt="image">
<p>:Author/Company: Put your name or company name here---this information is used in writing the copyright statement in the source files of your plugin, as well as being displayed in the Plugin Installer and on the <a href="http://plugins.qgis.org/plugins">QGIS plugin repository</a>.</p>
<dl>
<dt>Email address</dt>
<dd><p>Put an address where users of your plugin can contact you. This information is written to the copyright header of your source files and also displayed on the QGIS plugin repository listing for your plugin.</p>
</dd>
</dl>
<h4 id="optional-parameters">Optional Parameters</h4>
<p>There are several optional but highly recommended fields that you should consider completing when generating a new plugin.</p>
<dl>
<dt>Bug tracker</dt>
<dd><p>A URL pointing to the bug/issue tracker for your plugin. You can create a project with tracking for your plugin(s) at <a href="http://hub.qgis.org/projects/new">http://hub.qgis.org/projects/new</a>.</p>
</dd>
<dt>Home page</dt>
<dd><p>The URL of the home page for your plugin. This can be the same as the project page you create on hub.qgis.org or a site of your own.</p>
</dd>
<dt>Repository</dt>
<dd><p>The URL of the source code repository for your plugin. This allows others submit patches and improvements for your approval, as well as providing you with the benefit of source code control.</p>
</dd>
<dt>Tags</dt>
<dd><p>Tags are a comma separated list of keywords describing the function(s) of your plugin.</p>
</dd>
<dt>Experimental</dt>
<dd><p>Check this box if your plugin is considered experimental, meaning it is either incomplete or may cause unintended consequences. This allows users to filter out experimental plugins in the Plugin Installer if they choose not to live on the bleeding edge.</p>
</dd>
</dl>
<h1 id="results">Results</h1>
<p>When you click OK, Plugin Builder creates your new plugin for you and displays the results:</p>
<img src="images/plugin_results.png" alt="image">
<p>The results dialog tells you where your plugin was saved, the location of your QGIS plugin directory, and what to do next. This same information is contained in the <code>README.html</code> and <code>README.html</code> files in your generated plugin directory.</p>
<h1 id="compiling">Compiling</h1>
<p>After you generate your plugin there are two files that must be compiled before it is functional in QGIS:</p>
<ul>
<li>resources.qrc</li>
<li>The .ui file</li>
</ul>
<h4 id="the-resource-file">The Resource File</h4>
<p>The resource file contains definitions of media used in your plugin. Upon generation, this contains one entry for icon.png, the icon file for the plugin.</p>
<p>To compile the resource file into Python code, use the <code>pyrcc4</code> utility that comes as part of your PyQt installation:</p>
<pre><code>pyrcc4 -o resources.py resources.qrc</code></pre>
<h4 id="the-ui-file">The UI File</h4>
<p>The <code>.ui</code> file contains the definition of the user interface and must be compiled to Python code using <code>pyuic4</code>. For a generated plugin named mynewplugin, the UI file will be named <code>ui_mynewplugin.ui</code> and to compile it you would you would use:</p>
<pre><code>pyuic4 -o ui_mynewplugin.py ui_mynewplugin.ui</code></pre>
<p>Once the resource and UI files are compiled, the generated plugin can be loaded in QGIS.</p>
<h1 id="deploying">Deploying</h1>
<p>To deploy your new plugin during development, you have two choices:</p>
<ol>
<li>Copy the entire plugin directory to your QGIS plugins directory</li>
<li>Use the <code>QGIS_PLUGINPATH</code> environment variable to point to the directory where your development plugin(s) are located</li>
</ol>
<h4 id="the-copy-method">The Copy Method</h4>
<p>To deploy in this fashion, simply copy your plugin directory to the location of your QGIS plugins. By platform, this location is:</p>
<ul>
<li><dl>
<dt>Linux: <code>.qgis/python/plugins</code> in your home directory, typically found at</dt>
<dd><p><code>/home/gsherman/.qgis/python/plugins</code></p>
</dd>
</dl></li>
<li><dl>
<dt>Mac OS X: <code>.qgis/python/plugins</code> in your home directory, typically</dt>
<dd><p><code>/Users/gsherman/.qgis/python/plugins</code></p>
</dd>
</dl></li>
<li><dl>
<dt>Windows: <code>%HOMEPATH%\.qgis\python\plugins</code>, by default,</dt>
<dd><p><code>C:\Documents and Settings\gsherman\.qgis\python\plugins</code></p>
</dd>
</dl></li>
</ul>
<p>Since each plugin must be contained in its own subdirectory in <code>.qgis/python/plugins</code>, make sure you copy the directory, not the files in the directory.</p>
<p>If your operating system supports gmake (GNU make), you can use the deploy target of the Makefile in your plugin directory to deploy directly to <code>.qgis/python/plugins</code>:</p>
<pre><code>make deploy</code></pre>
<h4 id="the-environment-variable-method">The Environment Variable Method</h4>
<p>Using the <code>QGIS_PLUGINPATH</code> environment variable you can tell QGIS to look in an additional location for plugins. This can be handy for development, allowing you to test your plugin without copying it to <code>.qgis/python/plugins</code>.</p>
<p>To use this method, set the <code>QGIS_PLUGINPATH</code> environment variable to point to your development directory before starting QGIS. When QGIS starts up, all the directories in <code>QGIS_PLUGINPATH</code> will be searched and those containing valid plugins will be added to the Plugin Manager.</p>
<h1 id="testing">Testing</h1>
<p>With your new plugin deployed, start up QGIS, open the Plugin Manager, and enable it. Then click on the tool or the menu item for the plugin to run it. If all is well, you should see something similar to this:</p>
<img src="images/plugin_test.png" alt="image">
<p>If the plugin throws an error make sure you have compiled the resource and UI file before deploying and testing.</p>
<p>Once the generated plugin is working it's your turn to customize the user interface and add the needed code to make it do something useful.</p>
<h1 id="using-the-makefile">Using the Makefile</h1>
<p>The make file can be used to compile and deploy your plugin, assuming you are using an operating environment that supports <a href="http://gnu.org/software/make">GNU make</a>. It also provides a number of other actions to aid in plugin development.</p>
<p>The following targets are supported</p>
<dl>
<dt>clean</dt>
<dd><p>Delete the compiled UI and resource files</p>
</dd>
<dt>compile</dt>
<dd><p>Compile the resource and UI files. This is the default target.</p>
</dd>
<dt>dclean</dt>
<dd><p>Same as <code>derase</code> but also removes any .svn entries</p>
</dd>
<dt>deploy</dt>
<dd><p>Deploy the plugin</p>
</dd>
<dt>derase</dt>
<dd><p>Remove the deployed plugin</p>
</dd>
<dt>doc</dt>
<dd><p>Build the documentation using Sphinx</p>
</dd>
<dt>package</dt>
<dd><p>Package the plugin using git archive</p>
</dd>
<dt>transclean</dt>
<dd><p>Delete all .qm (translation) files</p>
</dd>
<dt>transcompile</dt>
<dd><p>Compile translation files into .qm format</p>
</dd>
<dt>transup</dt>
<dd><p>Update the .ts (translation) files</p>
</dd>
<dt>upload</dt>
<dd><p>Upload the plugin to the QGIS repository</p>
</dd>
<dt>zip</dt>
<dd><p>Deploy the plugin and create a zip file suitable for uploading to the QGIS repository</p>
</dd>
</dl>
<h1 id="documenting-your-plugin">Documenting your Plugin</h1>
<p>Plugin Builder creates a <a href="http://sphinx-doc.org">Sphinx</a> project for you in the <code>help</code> subdirectory of your plugin. To build the documentation you will need to install Sphinx using <a href="http://pypi.python.org/pypi/pip">pip</a> or <a href="http://peak.telecommunity.com/DevCenter/EasyInstall">easy_install</a>. Once installed, you can build the documentation using <code>make doc</code> or change to the <code>help</code> subdirectory and use <code>make html</code> (this works on any platform).</p>
<p>Sphinx supports building other formats, including latex, text, qthelp, and epub.</p>
<p>Of course you need to actually <em>write</em> something to document your plugin by editing <code>help/source/index.rst</code>.</p>
<p>Once your documentation is complete you can distribute it with your plugin, as well as publishing it on a website. You can also add a Help button to the button box group on the dialog and connect it to a method to show your help file in the user's default web browser. See the code in <code>pluginbuilder.py</code> for an example.</p>
<p>For an example of writing your documentation using Sphinx, you can <a href="_sources/index.txt">view</a> the source of this document.</p>
<h1 id="the-repository">The Repository</h1>
<p>When your plugin is ready to be shared with the QGIS community, upload it to the QGIS plugin repository at <a href="http://plugins.qgis.org/plugins">http://plugins.qgis.org/plugins</a>. Make sure to package it properly in zip format and test the zip before adding it to the repository.</p>
<p>When you add it to the repository, your plugin will show up in the Plugin Installer in QGIS, making it available for download and install by the community.</p>
</body>
</html>
